{
  "version": 3,
  "sources": ["../../assets/js/livex/index.js", "../../assets/js/livex/livex_url.js"],
  "sourcesContent": ["// Export all modules\nexport * from \"./livex_url.js\";\n", "/**\n * Builds two URLs from LiveView page and component params:\n *\n * 1. Primary URL: uses only `lv-url-<prop>` attributes.\n * 2. Combined URL: uses both `lv-url-<prop>` and `lv-data-<prop>` attributes.\n */\nfunction safeEncode(str) {\n\treturn encodeURIComponent(str).replace(/%5B/g, \"[\").replace(/%5D/g, \"]\");\n}\n\n/**\n * Given a route and params object, substitute path vars and serialize query.\n */\nfunction buildUrl(route, attrs) {\n\tlet url = route;\n\tconst remaining = {};\n\n\t// Substitute any :vars in path\n\tObject.entries(attrs).forEach(([key, val]) => {\n\t\tconst varPattern = new RegExp(`:${key}(?=/|$)`, \"g\");\n\t\tif (varPattern.test(url)) {\n\t\t\turl = url.replace(varPattern, encodeURIComponent(String(val)));\n\t\t} else {\n\t\t\tremaining[key] = val;\n\t\t}\n\t});\n\n\t// Serialize as query string\n\tconst parts = [];\n\tfunction serialize(obj, prefix) {\n\t\tif (obj == null) return;\n\t\tif (typeof obj === \"object\" && !Array.isArray(obj)) {\n\t\t\tObject.entries(obj).forEach(([k, v]) => serialize(v, `${prefix}[${k}]`));\n\t\t} else if (Array.isArray(obj)) {\n\t\t\tobj.forEach((v, i) => serialize(v, `${prefix}[${i}]`));\n\t\t} else {\n\t\t\tparts.push(`${safeEncode(prefix)}=${encodeURIComponent(String(obj))}`);\n\t\t}\n\t}\n\n\tObject.entries(remaining).forEach(([key, value]) => serialize(value, key));\n\treturn parts.length ? `${url}?${parts.join(\"&\")}` : url;\n}\n\n/**\n * Builds URLs from LiveView page and component params\n */\nfunction buildLvPageUrls() {\n\t// Grab page element and route\n\tconst pageEl = document.getElementById(\"lv-page-params\");\n\tif (!pageEl) throw new Error('Element with id \"lv-page-params\" not found.');\n\tconst route = pageEl.getAttribute(\"lv-route\");\n\tif (!route) throw new Error('Attribute \"lv-route\" not found.');\n\n\t// Collect page-level attrs\n\tconst urlAttrs = {};\n\tconst dataAttrs = {};\n\tArray.from(pageEl.attributes).forEach(({ name, value }) => {\n\t\tif (name.startsWith(\"lv-url-\")) {\n\t\t\tconst key = name.slice(\"lv-url-\".length);\n\t\t\turlAttrs[key] = JSON.parse(value);\n\t\t} else if (name.startsWith(\"lv-data-\")) {\n\t\t\tconst key = name.slice(\"lv-data-\".length);\n\t\t\tdataAttrs[key] = JSON.parse(value);\n\t\t}\n\t});\n\n\t// Collect component-level attrs\n\tdocument.querySelectorAll(\"div[data-phx-component]\").forEach((comp) => {\n\t\tconst compId = comp.id;\n\t\tif (!compId) return;\n\t\tconst compKey = `_${compId}`;\n\t\tArray.from(comp.attributes).forEach(({ name, value }) => {\n\t\t\tif (name.startsWith(\"lv-url-\")) {\n\t\t\t\tconst key = name.slice(\"lv-url-\".length);\n\t\t\t\turlAttrs[compKey] = urlAttrs[compKey] || {};\n\t\t\t\turlAttrs[compKey][key] = JSON.parse(value);\n\t\t\t} else if (name.startsWith(\"lv-data-\")) {\n\t\t\t\tconst key = name.slice(\"lv-data-\".length);\n\t\t\t\tdataAttrs[compKey] = dataAttrs[compKey] || {};\n\t\t\t\tdataAttrs[compKey][key] = JSON.parse(value);\n\t\t\t}\n\t\t});\n\t});\n\n\t// Build primary URL (only lv-url)\n\tconst primaryUrl = buildUrl(route, urlAttrs);\n\n\t// Merge urlAttrs + dataAttrs for combined\n\tconst combined = {};\n\tObject.keys(urlAttrs).forEach((k) => (combined[k] = urlAttrs[k]));\n\tObject.entries(dataAttrs).forEach(([k, v]) => {\n\t\tif (\n\t\t\tcombined[k] &&\n\t\t\ttypeof combined[k] === \"object\" &&\n\t\t\ttypeof v === \"object\"\n\t\t) {\n\t\t\tcombined[k] = { ...combined[k], ...v };\n\t\t} else {\n\t\t\tcombined[k] = v;\n\t\t}\n\t});\n\tconst combinedUrl = buildUrl(route, combined);\n\n\treturn { primaryUrl, combinedUrl };\n}\n\n/**\n * Enhances a LiveSocket instance with URL management capabilities\n */\nexport function enhanceLiveSocket(liveSocket) {\n\tliveSocket.domCallbacks.onPatchEnd = function (el) {\n\t\ttry {\n\t\t\tconst uris = buildLvPageUrls();\n\t\t\tconst url1 = new URL(uris.primaryUrl, window.location.origin);\n\t\t\tconst url = new URL(uris.combinedUrl, window.location.origin);\n\n\t\t\tconsole.log(\"updating view href\");\n\t\t\tconsole.log(\"before \" + window.liveSocket.href);\n\t\t\tconsole.log(\"after \" + url1.href);\n\t\t\tconsole.log(\"after 2\" + url.href);\n\n\t\t\tliveSocket.historyPatch(url1.href, \"push\");\n\n\t\t\t// update the global href too (for fallback reloads)\n\t\t\twindow.liveSocket.href = url1.href;\n\n\t\t\t// update only the main LiveView's href\n\t\t\tif (window.liveSocket.main) {\n\t\t\t\twindow.liveSocket.main.setHref(url.href);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error updating URL:\", error);\n\t\t}\n\t};\n\n\t// Add a helper method to push patch URLs\n\tliveSocket.pushPatchUrl = (href, linkState = {}) => {\n\t\tliveSocket.historyPatch(href, linkState);\n\t};\n\n\t// Add event listener for JS execution\n\twindow.addEventListener(\"phx:js-execute\", ({ detail }) => {\n\t\tconsole.log(\"js-execute\");\n\t\tconsole.log(detail.ops);\n\t\tliveSocket.execJS(document.body, detail.ops);\n\t});\n\n\treturn liveSocket;\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACMA,SAAS,WAAW,KAAK;AACxB,SAAO,mBAAmB,GAAG,EAAE,QAAQ,QAAQ,GAAG,EAAE,QAAQ,QAAQ,GAAG;AACxE;AAKA,SAAS,SAAS,OAAO,OAAO;AAC/B,MAAI,MAAM;AACV,QAAM,YAAY,CAAC;AAGnB,SAAO,QAAQ,KAAK,EAAE,QAAQ,CAAC,CAAC,KAAK,GAAG,MAAM;AAC7C,UAAM,aAAa,IAAI,OAAO,IAAI,GAAG,WAAW,GAAG;AACnD,QAAI,WAAW,KAAK,GAAG,GAAG;AACzB,YAAM,IAAI,QAAQ,YAAY,mBAAmB,OAAO,GAAG,CAAC,CAAC;AAAA,IAC9D,OAAO;AACN,gBAAU,GAAG,IAAI;AAAA,IAClB;AAAA,EACD,CAAC;AAGD,QAAM,QAAQ,CAAC;AACf,WAAS,UAAU,KAAK,QAAQ;AAC/B,QAAI,OAAO;AAAM;AACjB,QAAI,OAAO,QAAQ,YAAY,CAAC,MAAM,QAAQ,GAAG,GAAG;AACnD,aAAO,QAAQ,GAAG,EAAE,QAAQ,CAAC,CAAC,GAAG,CAAC,MAAM,UAAU,GAAG,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC;AAAA,IACxE,WAAW,MAAM,QAAQ,GAAG,GAAG;AAC9B,UAAI,QAAQ,CAAC,GAAG,MAAM,UAAU,GAAG,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC;AAAA,IACtD,OAAO;AACN,YAAM,KAAK,GAAG,WAAW,MAAM,CAAC,IAAI,mBAAmB,OAAO,GAAG,CAAC,CAAC,EAAE;AAAA,IACtE;AAAA,EACD;AAEA,SAAO,QAAQ,SAAS,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM,UAAU,OAAO,GAAG,CAAC;AACzE,SAAO,MAAM,SAAS,GAAG,GAAG,IAAI,MAAM,KAAK,GAAG,CAAC,KAAK;AACrD;AAKA,SAAS,kBAAkB;AAE1B,QAAM,SAAS,SAAS,eAAe,gBAAgB;AACvD,MAAI,CAAC;AAAQ,UAAM,IAAI,MAAM,6CAA6C;AAC1E,QAAM,QAAQ,OAAO,aAAa,UAAU;AAC5C,MAAI,CAAC;AAAO,UAAM,IAAI,MAAM,iCAAiC;AAG7D,QAAM,WAAW,CAAC;AAClB,QAAM,YAAY,CAAC;AACnB,QAAM,KAAK,OAAO,UAAU,EAAE,QAAQ,CAAC,EAAE,MAAM,MAAM,MAAM;AAC1D,QAAI,KAAK,WAAW,SAAS,GAAG;AAC/B,YAAM,MAAM,KAAK,MAAM,UAAU,MAAM;AACvC,eAAS,GAAG,IAAI,KAAK,MAAM,KAAK;AAAA,IACjC,WAAW,KAAK,WAAW,UAAU,GAAG;AACvC,YAAM,MAAM,KAAK,MAAM,WAAW,MAAM;AACxC,gBAAU,GAAG,IAAI,KAAK,MAAM,KAAK;AAAA,IAClC;AAAA,EACD,CAAC;AAGD,WAAS,iBAAiB,yBAAyB,EAAE,QAAQ,CAAC,SAAS;AACtE,UAAM,SAAS,KAAK;AACpB,QAAI,CAAC;AAAQ;AACb,UAAM,UAAU,IAAI,MAAM;AAC1B,UAAM,KAAK,KAAK,UAAU,EAAE,QAAQ,CAAC,EAAE,MAAM,MAAM,MAAM;AACxD,UAAI,KAAK,WAAW,SAAS,GAAG;AAC/B,cAAM,MAAM,KAAK,MAAM,UAAU,MAAM;AACvC,iBAAS,OAAO,IAAI,SAAS,OAAO,KAAK,CAAC;AAC1C,iBAAS,OAAO,EAAE,GAAG,IAAI,KAAK,MAAM,KAAK;AAAA,MAC1C,WAAW,KAAK,WAAW,UAAU,GAAG;AACvC,cAAM,MAAM,KAAK,MAAM,WAAW,MAAM;AACxC,kBAAU,OAAO,IAAI,UAAU,OAAO,KAAK,CAAC;AAC5C,kBAAU,OAAO,EAAE,GAAG,IAAI,KAAK,MAAM,KAAK;AAAA,MAC3C;AAAA,IACD,CAAC;AAAA,EACF,CAAC;AAGD,QAAM,aAAa,SAAS,OAAO,QAAQ;AAG3C,QAAM,WAAW,CAAC;AAClB,SAAO,KAAK,QAAQ,EAAE,QAAQ,CAAC,MAAO,SAAS,CAAC,IAAI,SAAS,CAAC,CAAE;AAChE,SAAO,QAAQ,SAAS,EAAE,QAAQ,CAAC,CAAC,GAAG,CAAC,MAAM;AAC7C,QACC,SAAS,CAAC,KACV,OAAO,SAAS,CAAC,MAAM,YACvB,OAAO,MAAM,UACZ;AACD,eAAS,CAAC,IAAI,EAAE,GAAG,SAAS,CAAC,GAAG,GAAG,EAAE;AAAA,IACtC,OAAO;AACN,eAAS,CAAC,IAAI;AAAA,IACf;AAAA,EACD,CAAC;AACD,QAAM,cAAc,SAAS,OAAO,QAAQ;AAE5C,SAAO,EAAE,YAAY,YAAY;AAClC;AAKO,SAAS,kBAAkB,YAAY;AAC7C,aAAW,aAAa,aAAa,SAAU,IAAI;AAClD,QAAI;AACH,YAAM,OAAO,gBAAgB;AAC7B,YAAM,OAAO,IAAI,IAAI,KAAK,YAAY,OAAO,SAAS,MAAM;AAC5D,YAAM,MAAM,IAAI,IAAI,KAAK,aAAa,OAAO,SAAS,MAAM;AAE5D,cAAQ,IAAI,oBAAoB;AAChC,cAAQ,IAAI,YAAY,OAAO,WAAW,IAAI;AAC9C,cAAQ,IAAI,WAAW,KAAK,IAAI;AAChC,cAAQ,IAAI,YAAY,IAAI,IAAI;AAEhC,iBAAW,aAAa,KAAK,MAAM,MAAM;AAGzC,aAAO,WAAW,OAAO,KAAK;AAG9B,UAAI,OAAO,WAAW,MAAM;AAC3B,eAAO,WAAW,KAAK,QAAQ,IAAI,IAAI;AAAA,MACxC;AAAA,IACD,SAAS,OAAO;AACf,cAAQ,MAAM,uBAAuB,KAAK;AAAA,IAC3C;AAAA,EACD;AAGA,aAAW,eAAe,CAAC,MAAM,YAAY,CAAC,MAAM;AACnD,eAAW,aAAa,MAAM,SAAS;AAAA,EACxC;AAGA,SAAO,iBAAiB,kBAAkB,CAAC,EAAE,OAAO,MAAM;AACzD,YAAQ,IAAI,YAAY;AACxB,YAAQ,IAAI,OAAO,GAAG;AACtB,eAAW,OAAO,SAAS,MAAM,OAAO,GAAG;AAAA,EAC5C,CAAC;AAED,SAAO;AACR;",
  "names": []
}
